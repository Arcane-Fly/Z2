{
  "version": "1",
  "metadata": {
    "name": "z2-backend"
  },
  "build": {
    "provider": "python",
    "nixpacksPlan": {
      "phases": {
        "setup": {
          "nixPkgs": ["python312", "poetry"],
          "commands": [
            "pip install --upgrade pip",
            "pip install poetry==1.8.5",
            "export PATH=$HOME/.local/bin:$PATH"
          ]
        },
        "install": {
          "commands": [
            "poetry config virtualenvs.create false",
            "poetry install --no-dev --no-interaction --no-ansi"
          ]
        }
      }
    }
  },
  "deploy": {
    "startCommand": "python scripts/init_db.py && uvicorn app.main:app --host 0.0.0.0 --port $PORT",
    "healthCheckPath": "/health",
    "healthCheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  },
  "volumes": [
    {
      "name": "app_storage", 
      "mountPath": "/opt/app/storage"
    }
  ],
  "variables": {
    "STORAGE_PATH": "/opt/app/storage",
    "PYTHON_VERSION": "3.12",
    "POETRY_VERSION": "1.8.5"
  }
}
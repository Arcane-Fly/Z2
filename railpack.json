{
  "$schema": "https://schema.railpack.com",
  "services": {
    "backend": {
      "provider": "python",
      "packages": {
        "python": "3.12"
      },
      "buildAptPackages": ["libpq-dev", "gcc", "g++"],
      "rootDirectory": "./backend",
      "steps": {
        "install": {
          "commands": [
            "pip install --upgrade pip",
            "pip install poetry==1.8.5",
            "export PATH=\"$HOME/.local/bin:$PATH\"",
            "poetry config virtualenvs.create false",
            "poetry install --no-root --only=main"
          ]
        }
      },
      "deploy": {
        "inputs": [
          "...",
          { "step": "install" }
        ],
        "startCommand": "export PATH=\"$HOME/.local/bin:$PATH\" && python scripts/init_db.py && { poetry run python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT || python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT; }",
        "variables": {
          "PORT": "$PORT",
          "NODE_ENV": "production",
          "PYTHON_VERSION": "3.12",
          "POETRY_VERSION": "1.8.5",
          "STORAGE_PATH": "/opt/app/storage",
          "APP_NAME": "Z2 AI Workforce Platform",
          "APP_VERSION": "0.1.0",
          "DEBUG": "false",
          "LOG_LEVEL": "INFO",
          "CORS_ORIGINS": "[\"https://${{services.frontend.RAILWAY_PUBLIC_DOMAIN}}\"]",
          "API_V1_PREFIX": "/api/v1",
          "JWT_SECRET": "${{JWT_SECRET}}",
          "JWT_SECRET_KEY": "${{JWT_SECRET_KEY}}",
          "JWT_ACCESS_TOKEN_EXPIRE_MINUTES": "30",
          "JWT_REFRESH_TOKEN_EXPIRE_DAYS": "7",
          "DATABASE_URL": "${{DATABASE_URL}}",
          "DEFAULT_ADMIN_PASSWORD": "${{DEFAULT_ADMIN_PASSWORD}}",
          "_STORAGE_ALTERNATIVES": "Alternative mount paths: /data, /storage, /workspace/storage, /opt/app/storage"
        }
      },
      "volumes": [
        {
          "name": "app_storage",
          "mountPath": "/opt/app/storage"
        }
      ],
      "variables": {
        "STORAGE_PATH": "/opt/app/storage"
      }
    },
    "frontend": {
      "provider": "node",
      "packages": {
        "node": "20"
      },
      "rootDirectory": "./frontend",
      "steps": {
        "install": {
          "commands": [
            "npm install -g corepack@latest && corepack enable",
            "corepack prepare yarn@4.9.2 --activate",
            "yarn install --immutable"
          ]
        },
        "build": {
          "inputs": [{ "step": "install" }],
          "commands": ["yarn build"],
          "variables": {
            "NODE_ENV": "production",
            "VITE_API_BASE_URL": "https://${{services.backend.RAILWAY_PUBLIC_DOMAIN}}",
            "VITE_WS_BASE_URL": "wss://${{services.backend.RAILWAY_PUBLIC_DOMAIN}}",
            "VITE_APP_NAME": "Z2 AI Workforce Platform",
            "VITE_APP_VERSION": "0.1.0"
          }
        }
      },
      "deploy": {
        "inputs": [
          "...",
          { "step": "build" }
        ],
        "startCommand": "yarn vite preview --host 0.0.0.0 --port $PORT",
        "variables": {
          "PORT": "$PORT",
          "NODE_ENV": "production",
          "STORAGE_PATH": "/opt/app/storage"
        }
      },
      "volumes": [
        {
          "name": "app_storage",
          "mountPath": "/opt/app/storage"
        }
      ]
    }
  }
}